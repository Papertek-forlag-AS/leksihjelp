<!DOCTYPE html>
<html lang="nb">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Leksihjelp</title>
  <link rel="stylesheet" href="../styles/popup.css">
</head>
<body>
  <div class="app">
    <!-- Header -->
    <header class="header">
      <div class="logo">
        <span class="logo-icon">üìñ</span>
        <h1>Leksihjelp</h1>
      </div>
      <div class="header-actions">
        <button id="pin-btn" class="icon-btn pin-btn" title="Fest Leksihjelp til verkt√∏ylinjen">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2L12 6M15.5 7.5L19 4M8.5 7.5L5 4M7 8C7 8 4 12 4 14C4 16 6 17 8 17.5L8 22L10 22L10 17.5C10 17.5 12 18 14 17.5L14 22L16 22L16 17.5C18 17 20 16 20 14C20 12 17 8 17 8L7 8Z"/>
          </svg>
          <span class="pin-label">Fest</span>
        </button>
        <button id="settings-btn" class="icon-btn" title="Innstillinger">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
          </svg>
        </button>
      </div>
    </header>

    <!-- Pin instructions overlay -->
    <div id="pin-overlay" class="pin-overlay hidden">
      <div class="pin-overlay-content glass">
        <h3>Fest Leksihjelp til verkt√∏ylinjen</h3>
        <div class="pin-steps">
          <div class="pin-step">
            <span class="pin-step-num">1</span>
            <span>Klikk p√• puslespill-ikonet <strong>&#129513;</strong> i verkt√∏ylinjen</span>
          </div>
          <div class="pin-step">
            <span class="pin-step-num">2</span>
            <span>Finn <strong>Leksihjelp</strong> i listen over utvidelser</span>
          </div>
          <div class="pin-step">
            <span class="pin-step-num">3</span>
            <span>Klikk p&aring; pin-ikonet <strong>&#128204;</strong> ved siden av Leksihjelp</span>
          </div>
        </div>
        <button id="pin-dismiss-btn" class="btn-primary pin-dismiss-btn">Skj&oslash;nte!</button>
      </div>
    </div>

    <!-- Main View: Dictionary -->
    <section id="view-dictionary" class="view active">
      <div class="search-container">
        <div class="search-box glass">
          <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
          </svg>
          <input type="text" id="search-input" placeholder="S√∏k etter ord..." autocomplete="off">
          <button id="search-clear" class="search-clear hidden">&times;</button>
        </div>
        <div class="search-direction glass-subtle">
          <button id="dir-no-target" class="dir-btn active" title="Norsk ‚Üí M√•lspr√•k">
            NO ‚Üí <span class="target-lang-code">ES</span>
          </button>
          <button id="dir-target-no" class="dir-btn" title="M√•lspr√•k ‚Üí Norsk">
            <span class="target-lang-code">ES</span> ‚Üí NO
          </button>
        </div>
      </div>

      <div id="search-results" class="results">
        <div class="results-placeholder">
          <p>Skriv et ord for √• s√∏ke i ordboken</p>
        </div>
      </div>
    </section>

    <!-- Settings View -->
    <section id="view-settings" class="view">
      <div class="settings-back">
        <button id="settings-back-btn" class="text-btn">‚Üê Tilbake</button>
      </div>

      <div class="settings-group glass">
        <h3>Spr√•k</h3>
        <p class="settings-note">Velg m√•lspr√•k (krever omstart av utvidelsen)</p>
        <select id="setting-language" class="glass-input">
          <option value="es">Spansk</option>
          <option value="de">Tysk</option>
          <option value="fr">Fransk</option>
        </select>
      </div>

      <div class="settings-group glass" id="account-section">
        <h3>Konto</h3>

        <!-- Logged out state -->
        <div id="auth-logged-out">
          <p class="settings-note">Logg inn med Vipps for ElevenLabs-uttale og abonnement</p>
          <button id="vipps-login-btn" class="btn-vipps">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
            Logg inn med Vipps
          </button>

          <!-- Legacy access code (collapsible) -->
          <details class="legacy-code-section">
            <summary class="legacy-code-toggle">Har du en tilgangskode?</summary>
            <div class="legacy-code-content">
              <div class="code-input-row">
                <input type="text" id="setting-access-code" class="glass-input" placeholder="Skriv inn kode...">
                <button id="verify-code-btn" class="btn-primary">Bekreft</button>
              </div>
              <div id="code-status" class="code-status"></div>
            </div>
          </details>
        </div>

        <!-- Logged in state -->
        <div id="auth-logged-in" class="hidden">
          <div class="user-info">
            <div class="user-name" id="user-name"></div>
            <div class="user-email" id="user-email"></div>
          </div>

          <div id="subscription-badge" class="subscription-badge"></div>

          <div id="usage-section" class="hidden">
            <div class="usage-bar-container">
              <div class="usage-bar-label">
                <span>Gjenst√•ende uttale</span>
                <span id="usage-text">0 tegn</span>
              </div>
              <div class="usage-bar">
                <div class="usage-bar-fill" id="usage-bar-fill" style="width: 0%"></div>
              </div>
              <p class="usage-rollover-note">Ubrukte tegn overf√∏res til neste m√•ned</p>
            </div>
          </div>

          <div id="subscribe-section" class="hidden">
            <div class="subscribe-options">
              <button id="subscribe-btn" class="btn-primary" style="width:100%;margin-top:8px;">
                Abonner ‚Äî 29 kr/mnd (Vipps)
              </button>
              <button id="subscribe-yearly-btn" class="btn-stripe" style="width:100%;margin-top:6px;">
                Betal 290 kr/√•r (kort)
              </button>
            </div>
            <p class="settings-note" style="margin-top:4px;">Inkl. 10 000 tegn ElevenLabs-uttale per m√•ned (ubrukte tegn overf√∏res)</p>
          </div>

          <button id="logout-btn" class="btn-secondary" style="margin-top:10px;">
            Logg ut
          </button>
        </div>
      </div>

      <div class="settings-group glass">
        <h3>Ordforslag</h3>
        <label class="toggle-row">
          <span>Aktiver ordforslag ved skriving</span>
          <input type="checkbox" id="setting-prediction" checked>
          <span class="toggle-slider"></span>
        </label>
      </div>

      <div class="settings-group glass">
        <h3>Grammatikk i ordboken</h3>
        <p class="settings-note">Hvor mye grammatikk vil du se?</p>
        <div id="grammar-preset-selector" class="grammar-preset-row">
          <!-- Populated dynamically: 4 pill buttons -->
        </div>
        <button type="button" id="grammar-customize-toggle" class="grammar-customize-btn">
          Tilpass selv <span class="grammar-customize-arrow">&#9662;</span>
        </button>
        <div id="grammar-features-container" class="grammar-features-collapsed">
          <!-- Populated dynamically by JS -->
        </div>
      </div>

      <div class="settings-group glass">
        <h3>M√∏rk modus</h3>
        <label class="toggle-row">
          <span>Bruk m√∏rkt tema</span>
          <input type="checkbox" id="setting-darkmode">
          <span class="toggle-slider"></span>
        </label>
        <p class="settings-note" style="margin-top:6px;">F√∏lger systeminnstilling hvis ikke valgt manuelt</p>
      </div>

      <div class="settings-group glass">
        <h3>Hurtigtaster</h3>
        <div class="shortcut-list">
          <div class="shortcut-row">
            <span>Sl√• opp markert tekst</span>
            <kbd>Ctrl+Shift+D</kbd>
          </div>
          <div class="shortcut-row">
            <span>Les opp markert tekst</span>
            <kbd>Ctrl+Shift+S</kbd>
          </div>
          <div class="shortcut-row">
            <span>Pause/gjenoppta Leksihjelp</span>
            <kbd>Ctrl+Shift+P</kbd>
          </div>
        </div>
      </div>

      <!-- Removed Feide placeholder -->
    </section>

    <!-- Nav -->
    <nav class="bottom-nav glass">
      <button class="nav-btn active" data-view="dictionary" title="Ordbok">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
        </svg>
        <span>Ordbok</span>
      </button>
      <button id="pause-btn" class="nav-btn pause-nav-btn" title="Sett Leksihjelp p√• pause">
        <svg class="pause-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/>
        </svg>
        <svg class="play-icon hidden" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="5 3 19 12 5 21 5 3"/>
        </svg>
        <span class="pause-label">Pause</span>
      </button>
      <button class="nav-btn" data-view="settings" title="Innstillinger">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
        </svg>
        <span>Innstillinger</span>
      </button>
    </nav>
  </div>

  <script src="popup.js"></script>
</body>
</html>
